<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo En Vivo - Rifa Eitan</title>
    <!-- Mismos estilos que la landing para coherencia -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Confetti JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --chess-black: #1a1a1a;
            --chess-gold: #d4af37;
            --chess-white: #f0f0f0;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--chess-black);
            color: white;
            min-height: 100vh;
            background-image: radial-gradient(circle at center, #2a2a2a 0%, #000 100%);
        }

        h1, h2, h3 { font-family: 'Cinzel', serif; }

        /* Contenedor Principal */
        .raffle-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* √Årea del Sorteo (Ruleta) */
        .stage-area {
            background: rgba(255, 255, 255, 0.05);
            border: 4px solid var(--chess-gold);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }

        .prize-display {
            font-size: 1.5rem;
            color: #ccc;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .number-display {
            font-size: 8rem;
            font-weight: 800;
            font-family: 'Cinzel', serif;
            color: var(--chess-gold);
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.8);
            margin: 20px 0;
            min-height: 160px; /* Evitar saltos */
        }

        .winner-name-display {
            font-size: 2.5rem;
            color: white;
            min-height: 60px;
            font-weight: 300;
        }

        /* Controles */
        .controls-area {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .form-select-lg {
            background-color: #333;
            color: white;
            border: 2px solid #555;
            max-width: 500px;
        }

        .btn-sortear {
            background: linear-gradient(45deg, #d4af37, #f1c40f);
            color: black;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            padding: 10px 50px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
            transition: all 0.3s;
        }

        .btn-sortear:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(212, 175, 55, 1);
        }

        .btn-sortear:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Lista de Ganadores */
        .winners-list {
            background: white;
            color: black;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .winner-row {
            transition: all 0.3s;
            border-bottom: 1px solid #eee;
        }
        .winner-row:hover {
            background-color: #fff8e1;
        }
        .winner-row.new-winner {
            animation: highlight 2s ease;
            background-color: #fff3cd;
        }

        @keyframes highlight {
            0% { background-color: var(--chess-gold); }
            100% { background-color: #fff3cd; }
        }

        .bg-gold { background-color: var(--chess-gold) !important; }
        
        /* Stats */
        .stats-bar {
            color: #888;
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="raffle-container">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="text-warning display-4">Gran Sorteo Eitan 2026</h1>
            <p class="lead text-light">Sistema de Sorteo Aleatorio Certificado</p>
        </div>

        <!-- Estad√≠sticas r√°pidas -->
        <div class="stats-bar">
            <span id="total-numbers">Total N√∫meros: 0</span> | 
            <span id="available-numbers">En T√≥mbola: 0</span> | 
            <span id="winners-count">Ganadores: 0</span>
        </div>

        <!-- Escenario Principal -->
        <div class="stage-area">
            <div id="current-prize-label" class="prize-display">Selecciona un premio para comenzar</div>
            <div id="roulette-number" class="number-display">000</div>
            <div id="roulette-name" class="winner-name-display">-</div>
        </div>

        <!-- Controles -->
        <div class="controls-area">
            <select id="prize-selector" class="form-select form-select-lg">
                <option value="" selected disabled>üëá Elige el Premio a Sortear</option>
                <!-- Premios Peque√±os -->
                <optgroup label="Premios Utilitarios">
                    <option value="Calcetines de playa (T38)">Calcetines de playa (T38)</option>
                    <option value="Cubiertas desechables alimentos">Cubiertas desechables alimentos</option>
                    <option value="Rodillera para beb√©">Rodillera para beb√©</option>
                    <option value="Vendaje adhesivo m√©dico">Vendaje adhesivo m√©dico</option>
                    <option value="Cepillo silicona botella">Cepillo silicona botella</option>
                    <option value="Batidor de huevos">Batidor de huevos</option>
                    <option value="Maquinilla de afeitar manual">Maquinilla de afeitar manual</option>
                    <option value="Par de guantes de nitrilo">Par de guantes de nitrilo</option>
                </optgroup>
                <!-- Premios Medios -->
                <optgroup label="Premios Medios">
                    <option value="4 almohadillas de fregona">4 almohadillas de fregona</option>
                    <option value="Gafas de sol marca gen√©rica">Gafas de sol marca gen√©rica</option>
                    <option value="Kit de huellas para beb√©s">Kit de huellas para beb√©s</option>
                    <option value="Set juguetes Montessori">Set juguetes Montessori</option>
                    <option value="M√°scara de seda protecci√≥n solar">M√°scara de seda protecci√≥n solar</option>
                    <option value="Sable de luz LED">Sable de luz LED</option>
                    <option value="Mini linterna LED recargable">Mini linterna LED recargable</option>
                </optgroup>
                <!-- Premios Principales -->
                <optgroup label="üèÜ Premios Principales">
                    <option value="Tr√≠pode para tel√©fono m√≥vil">Tr√≠pode para tel√©fono m√≥vil</option>
                    <option value="Mini humidificador de aire">Mini humidificador de aire</option>
                    <option value="Polera de Goku (Unidad 2)">Polera de Goku (Unidad 2)</option>
                    <option value="Polera de Goku (Unidad 1)">Polera de Goku (Unidad 1)</option>
                    <option value="Sudadera Dragon Ball Z">Sudadera Dragon Ball Z</option>
                    <option value="1 docena de empanaditas">1 docena de empanaditas</option>
                    <option value="2 docenas de empanaditas">2 docenas de empanaditas</option>
                    <option value="Balanza digital inteligente">Balanza digital inteligente</option>
                    <option value="Micr√≥fono Lavalier K60">Micr√≥fono Lavalier K60</option>
                    <option value="‚òÖ PICADORA EL√âCTRICA ‚òÖ">‚òÖ PICADORA EL√âCTRICA ‚òÖ</option>
                </optgroup>
            </select>

            <button id="btn-draw" class="btn btn-sortear" onclick="startRaffle()" disabled>
                <i class="fas fa-play me-2"></i> SORTEAR
            </button>
        </div>

        <!-- Tabla de Resultados -->
        <h3 class="text-warning text-center mb-3">Bit√°cora de Ganadores</h3>
        <div class="winners-list">
            <table class="table table-striped mb-0">
                <thead class="bg-gold">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Premio</th>
                        <th scope="col" class="text-center">N¬∞ Ganador</th>
                        <th scope="col">Nombre</th>
                    </tr>
                </thead>
                <tbody id="winners-table-body">
                    <!-- Aqu√≠ se agregan los ganadores -->
                </tbody>
            </table>
        </div>
        
        <div class="text-center mt-3">
            <button class="btn btn-outline-light btn-sm" onclick="resetRaffle()">‚ö† Reiniciar Sorteo</button>
        </div>
    </div>

    <!-- L√≥gica del Sorteo -->
    <script>
        // 1. BASE DE DATOS (Copia exacta de index.html)
        const listadoVentas = [
            { nombre: "JUDITH NUNEZ", numeros: [1, 12, 20] },
            { nombre: "AYLIN MATUS", numeros: [7, 10, 21, 55, 100] },
            { nombre: "BENJAMIN MATUS", numeros: [56] },
            { nombre: "CLAUDIA MARIN", numeros: [2, 3, 150] },
            { nombre: "ANGELICA ALIAGA", numeros: [4, 5, 9, 11, 16, 24, 28, 29, 30, 57] },
            { nombre: "LILLY LOPEZ", numeros: [17, 37, 73] },
            { nombre: "ALEJANDRO SPINOLA", numeros: [25, 120] },
            { nombre: "JANETH GACITUA", numeros: [13, 51] },
            { nombre: "ELENA ACOSTA", numeros: [54, 60, 98, 121] },
            { nombre: "ANDREA YANEZ", numeros: [14, 45, 47] },
            { nombre: "VALENTINA ACOSTA", numeros: [8, 94] }, 
            { nombre: "SCARLETT CASTANEDA", numeros: [35, 67] },
            { nombre: "KATHY MORENO", numeros: [26, 40, 85, 86] },
            { nombre: "JOSE MATUS", numeros: [23, 66, 71, 77, 107] },
            { nombre: "INES VIDAL", numeros: [15, 19, 27, 33, 48, 79, 90, 115, 149] },
            { nombre: "JOHAN MATUS", numeros: [69, 125, 144] },
            { nombre: "MADDELINE CUBILLOS", numeros: [18, 88, 99, 110, 133] },
            { nombre: "CRISTIAN ESTRADA", numeros: [6, 96, 111, 122, 147] },
            { nombre: "MARTIN DIAZ", numeros: [134, 135, 136, 137, 138, 139, 140, 141, 142, 143] },
            { nombre: "IVAN RIQUELME", numeros: [22, 32, 34, 36, 38, 41, 44, 46, 50, 52, 58, 61, 80] },
            { nombre: "RITA CID", numeros: [49, 53] },
            { nombre: "ISAAC MENDEZ", numeros: [131, 132, 145, 146, 148] },
            { nombre: "JOSE MEZA", numeros: [31, 39, 42, 43, 119, 123] },
            { nombre: "BELEN CUBILLOS", numeros: [84, 117] },
            { nombre: "FRANCISCO RIVERA", numeros: [101, 102, 103, 104, 105] },
            { nombre: "EVELYN MOLINA", numeros: [91] },
            { nombre: "OMAR CONTRERAS", numeros: [59, 63, 64] },
            { nombre: "ROSA BARRIGA", numeros: [62, 65, 68, 70, 72] },
            { nombre: "MABEL ACOSTA", numeros: [74, 75, 76, 78, 81, 82, 83, 87, 89, 92, 93] },
            { nombre: "SUSANA CARDENAS", numeros: [108, 118, 127, 128, 130] },
            { nombre: "JAIR MOLINA", numeros: [95, 97, 106, 109, 112, 113, 114, 116, 124, 126, 129] },
            { nombre: "JUAN CARLOS CAMPOS", numeros: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0] }
        ];

        // 2. PREPARACI√ìN DE LA T√ìMBOLA
        // Convertimos la lista de ventas en un array plano de "Tickets"
        // Cada ticket es un objeto: { numero: 5, nombre: "Angelica" }
        // Excluimos los n√∫meros 0 (Donaciones sin n√∫mero)
        let tombola = [];
        let ganadoresHistoricos = []; // Para no repetir n√∫meros

        function initTombola() {
            tombola = [];
            listadoVentas.forEach(persona => {
                persona.numeros.forEach(num => {
                    if (num > 0) { // Solo n√∫meros v√°lidos
                        tombola.push({
                            numero: num,
                            nombre: persona.nombre
                        });
                    }
                });
            });
            updateStats();
        }

        // 3. L√ìGICA DEL SORTEO
        let isSpinning = false;
        const btnDraw = document.getElementById('btn-draw');
        const prizeSelector = document.getElementById('prize-selector');
        const numDisplay = document.getElementById('roulette-number');
        const nameDisplay = document.getElementById('roulette-name');
        const prizeLabel = document.getElementById('current-prize-label');
        const tableBody = document.getElementById('winners-table-body');

        // Habilitar bot√≥n solo si hay premio seleccionado
        prizeSelector.addEventListener('change', () => {
            btnDraw.disabled = false;
            prizeLabel.innerText = "Sorteando: " + prizeSelector.value;
            // Reset displays visuales
            numDisplay.style.color = 'var(--chess-gold)';
            numDisplay.innerText = "000";
            nameDisplay.innerText = "-";
        });

        function startRaffle() {
            if (isSpinning || tombola.length === 0) return;
            isSpinning = true;
            btnDraw.disabled = true;
            prizeSelector.disabled = true;

            const selectedPrize = prizeSelector.value;
            
            // Animaci√≥n de Ruleta
            let counter = 0;
            const totalDuration = 4000; // 4 segundos de emoci√≥n
            const intervalTime = 50; // Velocidad de cambio de n√∫meros visuales

            const spinInterval = setInterval(() => {
                // Mostrar n√∫mero al azar VISUALMENTE (no es el ganador a√∫n)
                const randomVisual = Math.floor(Math.random() * 150) + 1;
                numDisplay.innerText = randomVisual;
                
                // Efecto de color
                numDisplay.style.color = counter % 2 === 0 ? '#fff' : 'var(--chess-gold)';
                counter++;
            }, intervalTime);

            // Detener y elegir ganador real
            setTimeout(() => {
                clearInterval(spinInterval);
                pickWinner(selectedPrize);
            }, totalDuration);
        }

        function pickWinner(prize) {
            // Elegir √≠ndice aleatorio de la t√≥mbola actual
            const winnerIndex = Math.floor(Math.random() * tombola.length);
            const winnerTicket = tombola[winnerIndex];

            // MOSTRAR RESULTADO
            numDisplay.innerText = winnerTicket.numero;
            numDisplay.style.color = '#e74c3c'; // Rojo vibrante para el ganador
            nameDisplay.innerText = winnerTicket.nombre;

            // EFECTOS
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });

            // REGISTRAR Y EXCLUIR
            // Eliminamos este n√∫mero espec√≠fico de la t√≥mbola para que no vuelva a salir
            // (Splice elimina el elemento en el √≠ndice winnerIndex)
            tombola.splice(winnerIndex, 1);

            // Agregar a la tabla
            addToTable(prize, winnerTicket);

            // Resetear estado
            isSpinning = false;
            prizeSelector.disabled = false;
            // Quitamos el premio de la lista o lo dejamos seleccionado para el siguiente?
            // Mejor lo dejamos, el usuario cambia manualmente.
            // Pero deshabilitamos el boton hasta que cambie o confirme.
            // btnDraw.disabled = false; // Descomentar si se permite repetir premio sin cambiar
            updateStats();
        }

        function addToTable(prize, ticket) {
            const row = document.createElement('tr');
            row.classList.add('winner-row', 'new-winner');
            const count = tableBody.children.length + 1;
            
            row.innerHTML = `
                <th scope="row">${count}</th>
                <td>${prize}</td>
                <td class="text-center fw-bold fs-5">${ticket.numero}</td>
                <td>${ticket.nombre}</td>
            `;
            
            // Insertar al principio para ver el √∫ltimo ganador arriba
            tableBody.insertBefore(row, tableBody.firstChild);
        }

        function updateStats() {
            document.getElementById('total-numbers').innerText = `Total N√∫meros: 150`; // Base fija
            document.getElementById('available-numbers').innerText = `En T√≥mbola: ${tombola.length}`;
            document.getElementById('winners-count').innerText = `Ganadores: ${150 - tombola.length}`; // Asumiendo base 150 - disponibles
        }

        function resetRaffle() {
            if(confirm("¬øEst√°s seguro de reiniciar todo el sorteo? Se perder√° el historial.")) {
                initTombola();
                tableBody.innerHTML = '';
                numDisplay.innerText = "000";
                nameDisplay.innerText = "-";
                alert("Sorteo reiniciado.");
            }
        }

        // Inicializar al cargar
        initTombola();

    </script>
</body>
</html>